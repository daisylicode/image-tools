<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remove Object Online - Free AI Object Removal Tool</title>
    <meta name="description" content="Free online AI-powered object removal tool. Remove unwanted objects from photos with smart inpainting. No registration required.">
    <meta name="keywords" content="remove object, object removal, photo editing, AI inpainting, remove people, remove items">
    <meta name="author" content="Free Image Tools Online">
    <link rel="canonical" href="https://freeimagetools.online/tools/remove-object/">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Remove Object Online - Free AI Object Removal Tool">
    <meta property="og:description" content="Free online AI-powered object removal tool. Remove unwanted objects from photos with smart inpainting.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freeimagetools.online/tools/remove-object/">
    <meta property="og:image" content="https://freeimagetools.online/assets/og-remove-object.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Remove Object Online - Free AI Object Removal Tool">
    <meta name="twitter:description" content="Free online AI-powered object removal tool. Remove unwanted objects from photos with smart inpainting.">
    <meta name="twitter:image" content="https://freeimagetools.online/assets/og-remove-object.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/theme.css">
    <link rel="stylesheet" href="/styles/header.css">
    <link rel="stylesheet" href="/styles/footer.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="stylesheet" href="/styles/tools.css">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Object Removal Tool",
        "description": "Free online AI-powered object removal tool with smart inpainting",
        "url": "https://freeimagetools.online/tools/remove-object/",
        "applicationCategory": "ImageEditorApplication",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Organization",
            "name": "Free Image Tools Online"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to content -->
    <a href="#main-content" class="skip-to-content">Skip to content</a>
    
    <!-- Header -->
    <div id="header-container"></div>
    
    <!-- Main Content -->
    <main id="main-content">
        <div class="tool-container">
            <div class="tool-header">
                <h1 class="tool-title">Remove Object</h1>
                <p class="tool-description">Remove unwanted objects from your photos with AI-powered inpainting</p>
                <div class="alert alert-warning">
                    <span class="alert-icon">⚠️</span>
                    <div class="alert-content">
                        <div class="alert-title">Legal Notice</div>
                        <div class="alert-message">Only remove objects from images you own or have permission to edit.</div>
                    </div>
                </div>
            </div>
            
            <div class="tool-layout">
                <!-- Controls Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Removal Settings</h2>
                    
                    <!-- File Upload -->
                    <div class="form-group">
                        <file-drop-zone id="fileDrop" text="Select image to edit"></file-drop-zone>
                    </div>
                    
                    <!-- Brush Size -->
                    <div class="range-group">
                        <div class="range-label">
                            <span class="range-title">Brush Size</span>
                            <span class="range-value" id="brushSizeValue">20px</span>
                        </div>
                        <input type="range" id="brushSize" class="range-slider" min="5" max="100" value="20">
                    </div>
                    
                    <!-- Brush Preview -->
                    <div class="brush-size-preview">
                        <div class="brush-preview-dot" id="brushPreview"></div>
                    </div>
                    
                    <!-- Inpaint Method -->
                    <div class="form-group">
                        <label class="form-label" for="inpaintMethod">Inpaint Method</label>
                        <select id="inpaintMethod" class="select-control">
                            <option value="telea">Telea (Fast)</option>
                            <option value="navier-stokes">Navier-Stokes (Quality)</option>
                            <option value="simple">Simple (Basic)</option>
                        </select>
                    </div>
                    
                    <!-- Actions -->
                    <div class="tool-actions">
                        <button id="clearSelection" class="btn btn-secondary" disabled>Clear Selection</button>
                        <button id="removeObject" class="btn btn-primary" disabled>Remove Object</button>
                        <button id="downloadResult" class="btn btn-success" disabled>Download</button>
                    </div>
                </div>
                
                <!-- Preview Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Preview</h2>
                    <div class="image-preview" id="removePreview">
                        <div class="image-preview-empty">
                            <p>Upload an image to start removing objects</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    
    <!-- Scripts -->
    <script type="module" src="/scripts/ui/header.js"></script>
    <script type="module" src="/scripts/ui/footer.js"></script>
    <script type="module" src="/scripts/core/i18n.js"></script>
    <script type="module" src="/scripts/ui/theme.js"></script>
    <script type="module" src="/scripts/ui/toasts.js"></script>
    <script type="module" src="/scripts/ui/file-drop.js"></script>
    <script type="module" src="/scripts/core/image-utils.js"></script>
    <script type="module" src="/scripts/ui/layout-components.js"></script>
    <script type="module" src="/scripts/core/download.js"></script>
    <script type="module" src="/scripts/core/worker-pool.js"></script>
    
    <!-- Remove Object Tool Script -->
    <script type="module">
        import { I18n } from '/scripts/core/i18n.js'
        import themeManager from '/scripts/ui/theme.js'
        import toastManager from '/scripts/ui/toasts.js'
        import { ImageUtils } from '/scripts/core/image-utils.js'
        import { DownloadUtils } from '/scripts/core/download.js'
        import { WorkerPools } from '/scripts/core/worker-pool.js'
        import LayoutComponents from '/scripts/ui/layout-components.js'
        
        class RemoveObjectTool {
            constructor() {
                this.originalImage = null
                this.processedImage = null
                this.brushSize = 20
                this.isDrawing = false
                this.selection = []
                this.workerPool = null
                
                this.init()
            }
            
            init() {
                this.setupEventListeners()
                this.updateUI()
                
                // Initialize worker pool
                if (WorkerPools.inpaint) {
                    this.workerPool = WorkerPools.inpaint
                }
            }
            
            setupEventListeners() {
                // File drop zone
                const fileDrop = document.getElementById('fileDrop')
                fileDrop.setOnFileSelected(this.handleFileSelect.bind(this))
                
                // Brush size slider
                const brushSizeSlider = document.getElementById('brushSize')
                brushSizeSlider.addEventListener('input', (e) => {
                    this.brushSize = parseInt(e.target.value)
                    document.getElementById('brushSizeValue').textContent = this.brushSize + 'px'
                    this.updateBrushPreview()
                })
                
                // Action buttons
                document.getElementById('clearSelection').addEventListener('click', () => {
                    this.clearSelection()
                })
                
                document.getElementById('removeObject').addEventListener('click', () => {
                    this.removeObject()
                })
                
                document.getElementById('downloadResult').addEventListener('click', () => {
                    this.downloadResult()
                })
            }
            
            handleFileSelect(file) {
                if (!file || !file.type.startsWith('image/')) {
                    toastManager.error('Please select a valid image file')
                    return
                }
                
                const reader = new FileReader()
                reader.onload = (e) => {
                    this.loadImage(e.target.result)
                }
                reader.readAsDataURL(file)
            }
            
            loadImage(imageSrc) {
                const img = new Image()
                img.onload = () => {
                    this.originalImage = img
                    this.displayImage(img)
                    this.updateUI()
                    toastManager.success('Image loaded successfully')
                }
                img.onerror = () => {
                    toastManager.error('Failed to load image')
                }
                img.src = imageSrc
            }
            
            displayImage(img) {
                const preview = document.getElementById('removePreview')
                preview.innerHTML = `
                    <div class="canvas-container">
                        <canvas id="removeCanvas"></canvas>
                        <canvas id="maskCanvas" class="canvas-overlay"></canvas>
                    </div>
                `
                
                const canvas = document.getElementById('removeCanvas')
                const maskCanvas = document.getElementById('maskCanvas')
                const ctx = canvas.getContext('2d')
                const maskCtx = maskCanvas.getContext('2d')
                
                // Set canvas size
                const maxWidth = preview.clientWidth - 40
                const maxHeight = 400
                
                let { width, height } = img
                
                if (width > maxWidth) {
                    height = (height * maxWidth) / width
                    width = maxWidth
                }
                
                if (height > maxHeight) {
                    width = (width * maxHeight) / height
                    height = maxHeight
                }
                
                canvas.width = width
                canvas.height = height
                maskCanvas.width = width
                maskCanvas.height = height
                
                // Draw image
                ctx.drawImage(img, 0, 0, width, height)
                
                // Setup mask canvas
                maskCtx.fillStyle = 'rgba(255, 0, 0, 0.5)'
                maskCtx.globalCompositeOperation = 'source-over'
                
                // Setup drawing events
                this.setupDrawingEvents(maskCanvas, maskCtx)
                
                // Update brush preview
                this.updateBrushPreview()
            }
            
            setupDrawingEvents(canvas, ctx) {
                canvas.addEventListener('mousedown', (e) => {
                    this.isDrawing = true
                    this.draw(e, canvas, ctx)
                })
                
                canvas.addEventListener('mousemove', (e) => {
                    if (this.isDrawing) {
                        this.draw(e, canvas, ctx)
                    }
                })
                
                canvas.addEventListener('mouseup', () => {
                    this.isDrawing = false
                })
                
                canvas.addEventListener('mouseleave', () => {
                    this.isDrawing = false
                })
                
                // Touch events for mobile
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault()
                    this.isDrawing = true
                    const touch = e.touches[0]
                    const mouseEvent = new MouseEvent('mousedown', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    })
                    canvas.dispatchEvent(mouseEvent)
                })
                
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault()
                    if (this.isDrawing) {
                        const touch = e.touches[0]
                        const mouseEvent = new MouseEvent('mousemove', {
                            clientX: touch.clientX,
                            clientY: touch.clientY
                        })
                        canvas.dispatchEvent(mouseEvent)
                    }
                })
                
                canvas.addEventListener('touchend', (e) => {
                    e.preventDefault()
                    this.isDrawing = false
                })
            }
            
            draw(e, canvas, ctx) {
                const rect = canvas.getBoundingClientRect()
                const x = e.clientX - rect.left
                const y = e.clientY - rect.top
                
                ctx.beginPath()
                ctx.arc(x, y, this.brushSize / 2, 0, 2 * Math.PI)
                ctx.fill()
                
                // Store selection point
                this.selection.push({ x, y, size: this.brushSize })
                
                // Update UI
                this.updateUI()
            }
            
            updateBrushPreview() {
                const preview = document.getElementById('brushPreview')
                if (preview) {
                    preview.style.width = this.brushSize + 'px'
                    preview.style.height = this.brushSize + 'px'
                }
            }
            
            clearSelection() {
                const maskCanvas = document.getElementById('maskCanvas')
                if (maskCanvas) {
                    const ctx = maskCanvas.getContext('2d')
                    ctx.clearRect(0, 0, maskCanvas.width, maskCanvas.height)
                }
                
                this.selection = []
                this.updateUI()
                toastManager.success('Selection cleared')
            }
            
            async removeObject() {
                console.log('removeObject called')
                console.log('originalImage:', !!this.originalImage)
                console.log('selection length:', this.selection.length)
                
                if (!this.originalImage || this.selection.length === 0) {
                    toastManager.error('Please select an area to remove')
                    return
                }
                
                try {
                    toastManager.info('Processing image...')
                    
                    const canvas = document.getElementById('removeCanvas')
                    const maskCanvas = document.getElementById('maskCanvas')
                    
                    if (!canvas || !maskCanvas) {
                        throw new Error('Canvas elements not found')
                    }
                    
                    console.log('Canvas elements found')
                    
                    // Get image data
                    const imageData = canvas.toDataURL()
                    const maskData = maskCanvas.toDataURL()
                    
                    console.log('Image data length:', imageData.length)
                    console.log('Mask data length:', maskData.length)
                    
                    // Always use client-side processing for now
                    await this.clientSideInpaint(imageData, maskData)
                    
                } catch (error) {
                    console.error('Inpainting failed:', error)
                    toastManager.error('Failed to remove object: ' + error.message)
                }
            }
            
            async clientSideInpaint(imageData, maskData) {
                console.log('clientSideInpaint started')
                
                return new Promise((resolve, reject) => {
                    const img = new Image()
                    img.onload = () => {
                        try {
                            console.log('Image loaded for processing, dimensions:', img.width, 'x', img.height)
                            
                            const canvas = document.createElement('canvas')
                            const ctx = canvas.getContext('2d')
                            
                            canvas.width = img.width
                            canvas.height = img.height
                            
                            // Draw original image
                            ctx.drawImage(img, 0, 0)
                            console.log('Original image drawn')
                            
                            // Apply simple blur effect to selected areas
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)
                            const data = imageData.data
                            
                            console.log('Selection points:', this.selection.length)
                            
                            // Simple blur effect
                            for (let i = 0; i < data.length; i += 4) {
                                const x = (i / 4) % canvas.width
                                const y = Math.floor((i / 4) / canvas.width)
                                
                                // Check if this pixel is in the selection area
                                const inSelection = this.selection.some(point => {
                                    const distance = Math.sqrt(
                                        Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2)
                                    )
                                    return distance <= point.size / 2
                                })
                                
                                if (inSelection) {
                                    // Apply simple blur by averaging with neighbors
                                    let r = 0, g = 0, b = 0, a = 0
                                    let count = 0
                                    
                                    for (let dy = -2; dy <= 2; dy++) {
                                        for (let dx = -2; dx <= 2; dx++) {
                                            const nx = x + dx
                                            const ny = y + dy
                                            
                                            if (nx >= 0 && nx < canvas.width && ny >= 0 && ny < canvas.height) {
                                                const nIndex = (ny * canvas.width + nx) * 4
                                                r += data[nIndex]
                                                g += data[nIndex + 1]
                                                b += data[nIndex + 2]
                                                a += data[nIndex + 3]
                                                count++
                                            }
                                        }
                                    }
                                    
                                    if (count > 0) {
                                        data[i] = r / count
                                        data[i + 1] = g / count
                                        data[i + 2] = b / count
                                        data[i + 3] = a / count
                                    }
                                }
                            }
                            
                            ctx.putImageData(imageData, 0, 0)
                            console.log('Blur effect applied')
                            
                            const resultDataUrl = canvas.toDataURL()
                            console.log('Result data URL created, length:', resultDataUrl.length)
                            
                            // Directly update the canvas without waiting for image loading
                            this.updateCanvasWithResult(resultDataUrl)
                            
                            toastManager.success('Object removed successfully')
                            resolve()
                            
                        } catch (error) {
                            console.error('Error in clientSideInpaint:', error)
                            reject(error)
                        }
                    }
                    img.onerror = () => {
                        console.error('Failed to load image for processing')
                        reject(new Error('Failed to load image for processing'))
                    }
                    img.src = imageData
                })
            }
            
            async displayProcessedImage(imageSrc) {
                try {
                    return new Promise((resolve, reject) => {
                        const img = new Image()
                        img.onload = () => {
                            const preview = document.getElementById('removePreview')
                            const oldCanvas = document.getElementById('removeCanvas')
                            
                            if (!oldCanvas) {
                                reject(new Error('Canvas not found'))
                                return
                            }
                            
                            const newCanvas = document.createElement('canvas')
                            const ctx = newCanvas.getContext('2d')
                            
                            newCanvas.width = oldCanvas.width
                            newCanvas.height = oldCanvas.height
                            
                            ctx.drawImage(img, 0, 0, newCanvas.width, newCanvas.height)
                            
                            oldCanvas.replaceWith(newCanvas)
                            newCanvas.id = 'removeCanvas'
                            
                            // Remove mask canvas
                            const maskCanvas = document.getElementById('maskCanvas')
                            if (maskCanvas) {
                                maskCanvas.remove()
                            }
                            
                            this.processedImage = newCanvas
                            this.updateUI()
                            resolve()
                        }
                        img.onerror = () => {
                            reject(new Error('Failed to load processed image'))
                        }
                        img.src = imageSrc
                    })
                } catch (error) {
                    console.error('Error displaying processed image:', error)
                    toastManager.error('Failed to display processed image')
                }
            }
            
            downloadResult() {
                if (!this.processedImage) {
                    toastManager.error('No processed image to download')
                    return
                }
                
                const filename = `removed_object_${Date.now()}.png`
                DownloadUtils.downloadCanvas(this.processedImage, filename)
                toastManager.success('Image downloaded successfully')
            }
            
            updateCanvasWithResult(resultDataUrl) {
                console.log('updateCanvasWithResult called')
                
                // Update the existing canvas directly
                const canvas = document.getElementById('removeCanvas')
                if (!canvas) {
                    console.error('Canvas not found for update')
                    return
                }
                
                const ctx = canvas.getContext('2d')
                const img = new Image()
                
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height)
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height)
                    
                    // Set as processed image
                    this.processedImage = canvas
                    
                    // Remove mask canvas
                    const maskCanvas = document.getElementById('maskCanvas')
                    if (maskCanvas) {
                        maskCanvas.remove()
                    }
                    
                    // Update UI
                    this.updateUI()
                    
                    console.log('Canvas updated successfully')
                }
                
                img.onerror = () => {
                    console.error('Failed to load result image')
                }
                
                img.src = resultDataUrl
            }
            
            updateUI() {
                const hasImage = this.originalImage !== null
                const hasSelection = this.selection.length > 0
                const hasProcessedImage = this.processedImage !== null
                
                document.getElementById('clearSelection').disabled = !hasSelection
                document.getElementById('removeObject').disabled = !hasSelection || hasProcessedImage
                document.getElementById('downloadResult').disabled = !hasProcessedImage
                
                console.log('UI updated - hasImage:', hasImage, 'hasSelection:', hasSelection, 'hasProcessedImage:', hasProcessedImage)
            }
        }
        
        // Initialize remove object tool when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize layout components
            const layout = new LayoutComponents()
            layout.init()
            
            // Initialize i18n
            I18n.init()
            
            // Initialize theme
            themeManager.init()
            
            // Initialize remove object tool
            const removeObjectTool = new RemoveObjectTool()
        })
    </script>
</body>
</html>