<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge Images Online - Free Image Combination Tool</title>
    <meta name="description" content="Free online image merging tool. Combine multiple images into one with customizable layouts. No registration required.">
    <meta name="keywords" content="merge images, combine images, image merger, online merge tool, photo collage">
    <meta name="author" content="Free Image Tools Online">
    <link rel="canonical" href="https://freeimagetools.online/tools/merge/">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Merge Images Online - Free Image Combination Tool">
    <meta property="og:description" content="Free online image merging tool. Combine multiple images into one with customizable layouts.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freeimagetools.online/tools/merge/">
    <meta property="og:image" content="https://freeimagetools.online/assets/og-merge.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Merge Images Online - Free Image Combination Tool">
    <meta name="twitter:description" content="Free online image merging tool. Combine multiple images into one with customizable layouts.">
    <meta name="twitter:image" content="https://freeimagetools.online/assets/og-merge.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/theme.css">
    <link rel="stylesheet" href="/styles/header.css">
    <link rel="stylesheet" href="/styles/footer.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="stylesheet" href="/styles/tools.css">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Image Merge Tool",
        "description": "Free online image merging tool with customizable layouts",
        "url": "https://freeimagetools.online/tools/merge/",
        "applicationCategory": "ImageEditorApplication",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Organization",
            "name": "Free Image Tools Online"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to content -->
    <a href="#main-content" class="skip-to-content">Skip to content</a>
    
    <!-- Header -->
    <div id="header-container"></div>
    
    <!-- Main Content -->
    <main id="main-content">
        <div class="tool-container">
            <div class="tool-header">
                <h1 class="tool-title">Merge Images</h1>
                <p class="tool-description">Combine multiple images into one with customizable layouts</p>
            </div>
            
            <div class="tool-layout">
                <!-- Controls Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Merge Settings</h2>
                    
                    <!-- File Upload -->
                    <div class="form-group">
                        <file-drop-zone id="fileDrop" text="Add images to merge" multiple></file-drop-zone>
                    </div>
                    
                    <!-- Images List -->
                    <div class="form-group">
                        <label class="form-label">Images to Merge</label>
                        <div class="merge-images-list" id="imagesList">
                            <div class="image-preview-empty">
                                <p>No images added yet</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Direction -->
                    <div class="form-group">
                        <label class="form-label" for="mergeDirection">Direction</label>
                        <select id="mergeDirection" class="select-control">
                            <option value="horizontal">Horizontal</option>
                            <option value="vertical">Vertical</option>
                        </select>
                    </div>
                    
                    <!-- Spacing -->
                    <div class="range-group">
                        <div class="range-label">
                            <span class="range-title">Spacing</span>
                            <span class="range-value" id="spacingValue">10px</span>
                        </div>
                        <input type="range" id="spacing" class="range-slider" min="0" max="50" value="10">
                    </div>
                    
                    <!-- Background Color -->
                    <div class="form-group">
                        <label class="form-label" for="backgroundColor">Background Color</label>
                        <input type="color" id="backgroundColor" class="form-control" value="#ffffff">
                    </div>
                    
                    <!-- Actions -->
                    <div class="tool-actions">
                        <button id="clearImages" class="btn btn-secondary" disabled>Clear All</button>
                        <button id="mergeImages" class="btn btn-primary" disabled>Merge Images</button>
                        <button id="downloadMerged" class="btn btn-success" disabled>Download</button>
                    </div>
                </div>
                
                <!-- Preview Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Preview</h2>
                    <div class="image-preview" id="mergePreview">
                        <div class="image-preview-empty">
                            <p>Add images to see merge preview</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    
    <!-- Scripts -->
    <script type="module" src="/scripts/ui/header.js"></script>
    <script type="module" src="/scripts/ui/footer.js"></script>
    <script type="module" src="/scripts/core/i18n.js"></script>
    <script type="module" src="/scripts/ui/theme.js"></script>
    <script type="module" src="/scripts/ui/toasts.js"></script>
    <script type="module" src="/scripts/ui/file-drop.js"></script>
    <script type="module" src="/scripts/core/image-utils.js"></script>
    <script type="module" src="/scripts/ui/layout-components.js"></script>
    <script type="module" src="/scripts/core/download.js"></script>
    
    <!-- Merge Tool Script -->
    <script type="module">
        import { I18n } from '/scripts/core/i18n.js'
        import themeManager from '/scripts/ui/theme.js'
        import toastManager from '/scripts/ui/toasts.js'
        import { ImageUtils } from '/scripts/core/image-utils.js'
        import { DownloadUtils } from '/scripts/core/download.js'
        import LayoutComponents from '/scripts/ui/layout-components.js'
        
        class MergeTool {
            constructor() {
                this.images = []
                this.mergedImage = null
                
                this.init()
            }
            
            init() {
                this.setupEventListeners()
                this.updateUI()
            }
            
            setupEventListeners() {
                // File drop zone
                const fileDrop = document.getElementById('fileDrop')
                fileDrop.setOnFilesDropped(this.handleFilesDropped.bind(this))
                
                // Spacing slider
                const spacingSlider = document.getElementById('spacing')
                spacingSlider.addEventListener('input', (e) => {
                    document.getElementById('spacingValue').textContent = e.target.value + 'px'
                    this.updatePreview()
                })
                
                // Direction change
                document.getElementById('mergeDirection').addEventListener('change', () => {
                    this.updatePreview()
                })
                
                // Background color change
                document.getElementById('backgroundColor').addEventListener('change', () => {
                    this.updatePreview()
                })
                
                // Action buttons
                document.getElementById('clearImages').addEventListener('click', () => {
                    this.clearImages()
                })
                
                document.getElementById('mergeImages').addEventListener('click', () => {
                    this.mergeImages()
                })
                
                document.getElementById('downloadMerged').addEventListener('click', () => {
                    this.downloadMergedImage()
                })
            }
            
            handleFilesDropped(files) {
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        this.addImage(file)
                    }
                })
                
                if (files.length > 0) {
                    toastManager.success(`${files.length} image(s) added`)
                }
            }
            
            addImage(file) {
                const reader = new FileReader()
                reader.onload = (e) => {
                    const img = new Image()
                    img.onload = () => {
                        this.images.push({
                            file: file,
                            image: img,
                            src: e.target.result,
                            id: Date.now() + Math.random()
                        })
                        this.updateImagesList()
                        this.updatePreview()
                        this.updateUI()
                    }
                    img.src = e.target.result
                }
                reader.readAsDataURL(file)
            }
            
            updateImagesList() {
                const list = document.getElementById('imagesList')
                
                if (this.images.length === 0) {
                    list.innerHTML = '<div class="image-preview-empty"><p>No images added yet</p></div>'
                    return
                }
                
                list.innerHTML = this.images.map((imgData, index) => `
                    <div class="merge-image-item">
                        <img src="${imgData.src}" alt="Image ${index + 1}" class="merge-image-preview">
                        <div class="merge-image-info">
                            <div class="merge-image-name">${imgData.file.name}</div>
                            <div class="merge-image-size">${imgData.image.width} × ${imgData.image.height}</div>
                        </div>
                        <div class="merge-image-actions">
                            <button class="btn btn-icon btn-error" onclick="mergeTool.removeImage(${index})" title="Remove">
                                ×
                            </button>
                        </div>
                    </div>
                `).join('')
            }
            
            removeImage(index) {
                this.images.splice(index, 1)
                this.updateImagesList()
                this.updatePreview()
                this.updateUI()
                toastManager.success('Image removed')
            }
            
            clearImages() {
                this.images = []
                this.mergedImage = null
                this.updateImagesList()
                this.updatePreview()
                this.updateUI()
                toastManager.success('All images cleared')
            }
            
            updatePreview() {
                if (this.images.length === 0) {
                    document.getElementById('mergePreview').innerHTML = '<div class="image-preview-empty"><p>Add images to see merge preview</p></div>'
                    return
                }
                
                const direction = document.getElementById('mergeDirection').value
                const spacing = parseInt(document.getElementById('spacing').value)
                const backgroundColor = document.getElementById('backgroundColor').value
                
                const canvas = document.createElement('canvas')
                const ctx = canvas.getContext('2d')
                
                // Calculate dimensions
                let totalWidth = 0
                let totalHeight = 0
                let maxHeight = 0
                let maxWidth = 0
                
                this.images.forEach(imgData => {
                    if (direction === 'horizontal') {
                        totalWidth += imgData.image.width
                        maxHeight = Math.max(maxHeight, imgData.image.height)
                    } else {
                        totalHeight += imgData.image.height
                        maxWidth = Math.max(maxWidth, imgData.image.width)
                    }
                })
                
                // Add spacing
                if (direction === 'horizontal') {
                    totalWidth += spacing * (this.images.length - 1)
                    totalHeight = maxHeight
                } else {
                    totalHeight += spacing * (this.images.length - 1)
                    totalWidth = maxWidth
                }
                
                // Set canvas size
                canvas.width = totalWidth
                canvas.height = totalHeight
                
                // Fill background
                ctx.fillStyle = backgroundColor
                ctx.fillRect(0, 0, totalWidth, totalHeight)
                
                // Draw images
                let currentX = 0
                let currentY = 0
                
                this.images.forEach(imgData => {
                    const img = imgData.image
                    
                    if (direction === 'horizontal') {
                        ctx.drawImage(img, currentX, (totalHeight - img.height) / 2)
                        currentX += img.width + spacing
                    } else {
                        ctx.drawImage(img, (totalWidth - img.width) / 2, currentY)
                        currentY += img.height + spacing
                    }
                })
                
                // Update preview
                const preview = document.getElementById('mergePreview')
                preview.innerHTML = ''
                
                const displayCanvas = document.createElement('canvas')
                const displayCtx = displayCanvas.getContext('2d')
                
                // Scale for display
                const maxDisplaySize = 400
                const scale = Math.min(maxDisplaySize / totalWidth, maxDisplaySize / totalHeight, 1)
                
                displayCanvas.width = totalWidth * scale
                displayCanvas.height = totalHeight * scale
                
                displayCtx.drawImage(canvas, 0, 0, displayCanvas.width, displayCanvas.height)
                
                preview.appendChild(displayCanvas)
                
                // Store for download
                this.previewCanvas = canvas
            }
            
            mergeImages() {
                if (this.images.length === 0) {
                    toastManager.error('Please add at least one image')
                    return
                }
                
                this.mergedImage = this.previewCanvas
                this.updateUI()
                toastManager.success('Images merged successfully')
            }
            
            downloadMergedImage() {
                if (!this.mergedImage) {
                    toastManager.error('No merged image to download')
                    return
                }
                
                const filename = `merged_image_${Date.now()}.png`
                DownloadUtils.downloadCanvas(this.mergedImage, filename)
                toastManager.success('Merged image downloaded successfully')
            }
            
            updateUI() {
                const hasImages = this.images.length > 0
                const hasMerged = this.mergedImage !== null
                
                document.getElementById('clearImages').disabled = !hasImages
                document.getElementById('mergeImages').disabled = !hasImages
                document.getElementById('downloadMerged').disabled = !hasMerged
            }
        }
        
        // Initialize merge tool when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize layout components
            const layout = new LayoutComponents()
            layout.init()
            
            // Initialize i18n
            I18n.init()
            
            // Initialize theme
            themeManager.init()
            
            // Initialize merge tool
            window.mergeTool = new MergeTool()
        })
    </script>
</body>
</html>