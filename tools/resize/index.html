<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resize Image Online - Free Image Resizing Tool</title>
    <meta name="description" content="Free online image resizing tool. Change image dimensions with aspect ratio control. Multiple formats supported.">
    <meta name="keywords" content="resize image, image resizer, change dimensions, scale image, photo resize">
    <meta name="author" content="Free Image Tools Online">
    <link rel="canonical" href="https://freeimagetools.online/tools/resize/">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Resize Image Online - Free Image Resizing Tool">
    <meta property="og:description" content="Free online image resizing tool. Change image dimensions with aspect ratio control.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://freeimagetools.online/tools/resize/">
    <meta property="og:image" content="https://freeimagetools.online/assets/og-resize.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Resize Image Online - Free Image Resizing Tool">
    <meta name="twitter:description" content="Free online image resizing tool. Change image dimensions with aspect ratio control.">
    <meta name="twitter:image" content="https://freeimagetools.online/assets/og-resize.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/theme.css">
    <link rel="stylesheet" href="/styles/header.css">
    <link rel="stylesheet" href="/styles/footer.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="stylesheet" href="/styles/tools.css">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Image Resize Tool",
        "description": "Free online image resizing tool with aspect ratio control",
        "url": "https://freeimagetools.online/tools/resize/",
        "applicationCategory": "ImageEditorApplication",
        "operatingSystem": "Web Browser",
        "author": {
            "@type": "Organization",
            "name": "Free Image Tools Online"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>
</head>
<body>
    <!-- Skip to content -->
    <a href="#main-content" class="skip-to-content">Skip to content</a>
    
    <!-- Header -->
    <div id="header-container"></div>
    
    <!-- Main Content -->
    <main id="main-content">
        <div class="tool-container">
            <div class="tool-header">
                <h1 class="tool-title">Resize Image</h1>
                <p class="tool-description">Change image dimensions with precise control</p>
            </div>
            
            <div class="tool-layout">
                <!-- Controls Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Resize Settings</h2>
                    
                    <!-- File Upload -->
                    <div class="form-group">
                        <file-drop-zone id="fileDrop" text="Select image to resize"></file-drop-zone>
                    </div>
                    
                    <!-- Resize Mode -->
                    <div class="form-group">
                        <label class="form-label">Resize Mode</label>
                        <div class="resize-modes">
                            <button class="resize-mode-btn active" data-mode="pixels">Pixels</button>
                            <button class="resize-mode-btn" data-mode="percentage">Percentage</button>
                        </div>
                    </div>
                    
                    <!-- Pixels Mode -->
                    <div id="pixelsMode" class="resize-dimensions">
                        <div class="form-group">
                            <label class="form-label" for="resizeWidth">Width (px)</label>
                            <input type="number" id="resizeWidth" class="form-control" placeholder="Auto" min="1">
                        </div>
                        <div class="resize-lock">
                            <button id="aspectRatioLock" class="resize-lock-btn active" title="Lock aspect ratio">
                                ðŸ”’
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="resizeHeight">Height (px)</label>
                            <input type="number" id="resizeHeight" class="form-control" placeholder="Auto" min="1">
                        </div>
                    </div>
                    
                    <!-- Percentage Mode -->
                    <div id="percentageMode" class="resize-dimensions" style="display: none;">
                        <div class="form-group">
                            <label class="form-label" for="resizePercentage">Scale (%)</label>
                            <input type="number" id="resizePercentage" class="form-control" value="100" min="1" max="500">
                        </div>
                    </div>
                    
                    <!-- Output Format -->
                    <div class="form-group">
                        <label class="form-label" for="outputFormat">Output Format</label>
                        <select id="outputFormat" class="select-control">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>
                    
                    <!-- Actions -->
                    <div class="tool-actions">
                        <button id="resetResize" class="btn btn-secondary" disabled>Reset</button>
                        <button id="applyResize" class="btn btn-primary" disabled>Apply Resize</button>
                        <button id="downloadResized" class="btn btn-success" disabled>Download</button>
                    </div>
                </div>
                
                <!-- Preview Panel -->
                <div class="tool-panel">
                    <h2 class="tool-panel-title">Preview</h2>
                    <div class="image-preview" id="resizePreview">
                        <div class="image-preview-empty">
                            <p>Upload an image to resize</p>
                        </div>
                    </div>
                    
                    <!-- Image Info -->
                    <div id="imageInfo" class="image-preview-info" style="display: none;">
                        <div class="compress-stats">
                            <div class="compress-stat">
                                <span class="compress-stat-label">Original Size</span>
                                <span class="compress-stat-value" id="originalSize">-</span>
                            </div>
                            <div class="compress-stat">
                                <span class="compress-stat-label">Resized Size</span>
                                <span class="compress-stat-value" id="resizedSize">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <div id="footer-container"></div>
    
    <!-- Scripts -->
    <script type="module" src="/scripts/ui/header.js"></script>
    <script type="module" src="/scripts/ui/footer.js"></script>
    <script type="module" src="/scripts/core/i18n.js"></script>
    <script type="module" src="/scripts/ui/theme.js"></script>
    <script type="module" src="/scripts/ui/toasts.js"></script>
    <script type="module" src="/scripts/ui/file-drop.js"></script>
    <script type="module" src="/scripts/core/image-utils.js"></script>
    <script type="module" src="/scripts/core/download.js"></script>
    <script type="module" src="/scripts/core/worker-pool.js"></script>
    <script type="module" src="/scripts/ui/layout-components.js"></script>
    
    <!-- Resize Tool Script -->
    <script type="module">
        import { I18n } from '/scripts/core/i18n.js'
        import themeManager from '/scripts/ui/theme.js'
        import toastManager from '/scripts/ui/toasts.js'
        import { ImageUtils } from '/scripts/core/image-utils.js'
        import { DownloadUtils } from '/scripts/core/download.js'
        import { WorkerPools } from '/scripts/core/worker-pool.js'
        import LayoutComponents from '/scripts/ui/layout-components.js'
        
        class ResizeTool {
            constructor() {
                this.originalImage = null
                this.resizedImage = null
                this.currentMode = 'pixels'
                this.aspectRatio = 1
                this.maintainAspectRatio = true
                this.workerPool = null
                
                this.init()
            }
            
            init() {
                this.setupEventListeners()
                this.updateUI()
                
                // Initialize worker pool
                if (WorkerPools.resize) {
                    this.workerPool = WorkerPools.resize
                }
            }
            
            setupEventListeners() {
                // File drop zone
                const fileDrop = document.getElementById('fileDrop')
                fileDrop.setOnFileSelected(this.handleFileSelect.bind(this))
                
                // Mode buttons
                document.querySelectorAll('.resize-mode-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setMode(btn.dataset.mode)
                    })
                })
                
                // Aspect ratio lock
                document.getElementById('aspectRatioLock').addEventListener('click', () => {
                    this.toggleAspectRatioLock()
                })
                
                // Dimension inputs
                const widthInput = document.getElementById('resizeWidth')
                const heightInput = document.getElementById('resizeHeight')
                const percentageInput = document.getElementById('resizePercentage')
                
                widthInput.addEventListener('input', () => {
                    if (this.maintainAspectRatio && this.currentMode === 'pixels') {
                        this.updateHeightFromWidth()
                    }
                })
                
                heightInput.addEventListener('input', () => {
                    if (this.maintainAspectRatio && this.currentMode === 'pixels') {
                        this.updateWidthFromHeight()
                    }
                })
                
                percentageInput.addEventListener('input', () => {
                    this.updateDimensionsFromPercentage()
                })
                
                // Action buttons
                document.getElementById('resetResize').addEventListener('click', () => {
                    this.resetResize()
                })
                
                document.getElementById('applyResize').addEventListener('click', () => {
                    this.applyResize()
                })
                
                document.getElementById('downloadResized').addEventListener('click', () => {
                    this.downloadResized()
                })
            }
            
            handleFileSelect(file) {
                if (!file || !file.type.startsWith('image/')) {
                    toastManager.error('Please select a valid image file')
                    return
                }
                
                const reader = new FileReader()
                reader.onload = (e) => {
                    this.loadImage(e.target.result, file)
                }
                reader.readAsDataURL(file)
            }
            
            loadImage(imageSrc, file) {
                const img = new Image()
                img.onload = () => {
                    this.originalImage = img
                    this.originalFile = file
                    this.aspectRatio = img.width / img.height
                    
                    // Set initial values
                    document.getElementById('resizeWidth').value = img.width
                    document.getElementById('resizeHeight').value = img.height
                    
                    this.displayImage(img)
                    this.updateImageInfo(img.width, img.height)
                    this.updateUI()
                    toastManager.success('Image loaded successfully')
                }
                img.onerror = () => {
                    toastManager.error('Failed to load image')
                }
                img.src = imageSrc
            }
            
            displayImage(img) {
                const preview = document.getElementById('resizePreview')
                preview.innerHTML = `
                    <div class="canvas-container">
                        <canvas id="resizeCanvas"></canvas>
                    </div>
                `
                
                const canvas = document.getElementById('resizeCanvas')
                const ctx = canvas.getContext('2d')
                
                // Set canvas size
                const maxWidth = preview.clientWidth - 40
                const maxHeight = 400
                
                let { width, height } = img
                
                if (width > maxWidth) {
                    height = (height * maxWidth) / width
                    width = maxWidth
                }
                
                if (height > maxHeight) {
                    width = (width * maxHeight) / height
                    height = maxHeight
                }
                
                canvas.width = width
                canvas.height = height
                
                // Draw image
                ctx.drawImage(img, 0, 0, width, height)
            }
            
            setMode(mode) {
                this.currentMode = mode
                
                // Update button states
                document.querySelectorAll('.resize-mode-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.mode === mode)
                })
                
                // Show/hide mode controls
                document.getElementById('pixelsMode').style.display = mode === 'pixels' ? 'grid' : 'none'
                document.getElementById('percentageMode').style.display = mode === 'percentage' ? 'block' : 'none'
            }
            
            toggleAspectRatioLock() {
                this.maintainAspectRatio = !this.maintainAspectRatio
                const lockBtn = document.getElementById('aspectRatioLock')
                lockBtn.classList.toggle('active', this.maintainAspectRatio)
                lockBtn.textContent = this.maintainAspectRatio ? 'ðŸ”’' : 'ðŸ”“'
            }
            
            updateHeightFromWidth() {
                const width = parseInt(document.getElementById('resizeWidth').value)
                if (!width || !this.originalImage) return
                
                const height = Math.round(width / this.aspectRatio)
                document.getElementById('resizeHeight').value = height
            }
            
            updateWidthFromHeight() {
                const height = parseInt(document.getElementById('resizeHeight').value)
                if (!height || !this.originalImage) return
                
                const width = Math.round(height * this.aspectRatio)
                document.getElementById('resizeWidth').value = width
            }
            
            updateDimensionsFromPercentage() {
                const percentage = parseInt(document.getElementById('resizePercentage').value)
                if (!percentage || !this.originalImage) return
                
                const width = Math.round(this.originalImage.width * percentage / 100)
                const height = Math.round(this.originalImage.height * percentage / 100)
                
                document.getElementById('resizeWidth').value = width
                document.getElementById('resizeHeight').value = height
            }
            
            updateImageInfo(width, height) {
                document.getElementById('originalSize').textContent = `${this.originalImage.width} Ã— ${this.originalImage.height}`
                document.getElementById('resizedSize').textContent = `${width} Ã— ${height}`
                document.getElementById('imageInfo').style.display = 'block'
            }
            
            resetResize() {
                if (!this.originalImage) return
                
                document.getElementById('resizeWidth').value = this.originalImage.width
                document.getElementById('resizeHeight').value = this.originalImage.height
                document.getElementById('resizePercentage').value = 100
                
                this.updateImageInfo(this.originalImage.width, this.originalImage.height)
                this.displayImage(this.originalImage)
                
                // Reset resized image
                this.resizedImage = null
                this.updateUI()
                
                toastManager.success('Resize reset to original size')
            }
            
            async applyResize() {
                console.log('applyResize called')
                console.log('originalImage:', !!this.originalImage)
                console.log('currentMode:', this.currentMode)
                
                if (!this.originalImage) {
                    toastManager.error('Please select an image first')
                    return
                }
                
                let newWidth, newHeight
                
                if (this.currentMode === 'pixels') {
                    newWidth = parseInt(document.getElementById('resizeWidth').value)
                    newHeight = parseInt(document.getElementById('resizeHeight').value)
                } else {
                    const percentage = parseInt(document.getElementById('resizePercentage').value)
                    newWidth = Math.round(this.originalImage.width * percentage / 100)
                    newHeight = Math.round(this.originalImage.height * percentage / 100)
                }
                
                console.log('New dimensions:', newWidth, 'x', newHeight)
                
                if (!newWidth || !newHeight || newWidth <= 0 || newHeight <= 0) {
                    toastManager.error('Please enter valid dimensions')
                    return
                }
                
                try {
                    toastManager.info('Resizing image...')
                    
                    const format = document.getElementById('outputFormat').value
                    console.log('Format:', format)
                    
                    // Always use client-side resizing for now
                    await this.clientSideResize(newWidth, newHeight, format)
                    
                } catch (error) {
                    console.error('Resize failed:', error)
                    toastManager.error('Failed to resize image: ' + error.message)
                }
            }
            
            async clientSideResize(newWidth, newHeight, format) {
                console.log('clientSideResize called')
                console.log('newWidth:', newWidth, 'newHeight:', newHeight, 'format:', format)
                
                const canvas = document.createElement('canvas')
                const ctx = canvas.getContext('2d')
                
                canvas.width = newWidth
                canvas.height = newHeight
                
                // High quality resizing
                ctx.imageSmoothingEnabled = true
                ctx.imageSmoothingQuality = 'high'
                
                // Draw resized image
                ctx.drawImage(this.originalImage, 0, 0, newWidth, newHeight)
                
                // Convert to blob
                const blob = await new Promise((resolve) => {
                    canvas.toBlob(resolve, `image/${format}`)
                })
                
                console.log('Blob created:', !!blob, 'size:', blob ? blob.size : 'unknown')
                
                // Convert to data URL
                const resizedData = await new Promise((resolve) => {
                    const reader = new FileReader()
                    reader.onload = () => resolve(reader.result)
                    reader.readAsDataURL(blob)
                })
                
                console.log('Data URL created:', !!resizedData, 'length:', resizedData ? resizedData.length : 'unknown')
                
                await this.displayResizedImageAsync(resizedData, {
                    originalWidth: this.originalImage.width,
                    originalHeight: this.originalImage.height,
                    newWidth,
                    newHeight,
                    format
                })
                
                toastManager.success('Image resized successfully')
            }
            
            async displayResizedImageAsync(resizedData, stats) {
                console.log('displayResizedImageAsync called')
                console.log('resizedData:', !!resizedData)
                console.log('stats:', stats)
                
                try {
                    const img = await this.createImageFromDataAsync(resizedData)
                    console.log('Image loaded successfully')
                    
                    // Update preview
                    this.displayImage(img)
                    
                    // Store resized image
                    this.resizedImage = img
                    this.resizedData = resizedData
                    this.resizedStats = stats
                    
                    console.log('Stored resized image:', !!this.resizedImage)
                    console.log('Stored resized data:', !!this.resizedData)
                    
                    // Update image info
                    this.updateImageInfo(stats.newWidth, stats.newHeight)
                    this.updateUI()
                    
                    console.log('UI updated, hasResized should now be true')
                    
                } catch (error) {
                    console.error('Error in displayResizedImageAsync:', error)
                    toastManager.error('Failed to display resized image')
                }
            }
            
            createImageFromDataAsync(imageData) {
                return new Promise((resolve, reject) => {
                    const img = new Image()
                    img.onload = () => resolve(img)
                    img.onerror = () => reject(new Error('Failed to load image'))
                    img.src = imageData
                })
            }
            
            displayResizedImage(resizedData, stats) {
                // Keep the old method for compatibility but use the async version
                this.displayResizedImageAsync(resizedData, stats)
            }
            
            downloadResized() {
                if (!this.resizedData) {
                    toastManager.error('No resized image to download')
                    return
                }
                
                const format = document.getElementById('outputFormat').value
                const filename = `resized_image_${Date.now()}.${format === 'jpeg' ? 'jpg' : format}`
                
                // Convert data URL to blob
                const blob = DownloadUtils.dataURLToBlob(this.resizedData)
                DownloadUtils.downloadFile(blob, filename)
                
                toastManager.success('Image downloaded successfully')
            }
            
            updateUI() {
                const hasImage = this.originalImage !== null
                const hasResized = this.resizedImage !== null
                
                console.log('updateUI called')
                console.log('hasImage:', hasImage)
                console.log('hasResized:', hasResized)
                console.log('resizedImage:', !!this.resizedImage)
                
                document.getElementById('resetResize').disabled = !hasImage
                document.getElementById('applyResize').disabled = !hasImage
                document.getElementById('downloadResized').disabled = !hasResized
            }
        }
        
        // Initialize resize tool when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize layout components
            const layout = new LayoutComponents()
            layout.init()
            
            // Initialize i18n
            I18n.init()
            
            // Initialize theme
            themeManager.init()
            
            // Initialize resize tool
            const resizeTool = new ResizeTool()
        })
    </script>
</body>
</html>